---
alwaysApply: false
---

Title: Testing & Quality

- **Linters**: Run ESLint/Prettier on changed files only. Do not reformat unrelated code.
- **Unit**: `vitest` for logic and utilities. Mock IO boundaries.
- **E2E**: `playwright` smoke for critical flows. Keep under 5 min runtime.
- **Types**: No `any`. Prefer precise generics. Enforce strict mode.
- **CI**: Cache deps; run lints, unit, then e2e (smoke) per PR.
- **Perf tests**: Track TTFB and hydration for key pages periodically.

Always run tests (agent + dev)

- **Local**: After making edits affecting logic, routes, server actions, or DB, run `npm test` locally and fix failures before opening/merging a PR.
- **Agent**: Background/automation must run `npm test` after code edits and before reporting success. If tests fail, fix them or surface the failures with a short justification and next steps.
- **Isolation**: Mock external services (AI, DB, network) by default in tests; avoid real outbound calls. Keep tests fast and deterministic.
- **Minimum**: For new routes/server actions, add at least one mocked integration test that exercises request/response and persistence logic.

Build validation

- Each task must pass a local build before PR: `pnpm build` (or `flox activate -- bash -c "pnpm build"`).
- Fix type errors and edge runtime issues surfaced by the build.

Per-task requirement

- Every task must include adequate tests: unit for logic, and e2e or component tests for user-facing flows.
- New code without tests is not eligible for merge unless explicitly justified.

Vitest Example

```ts
test("formats date", () => {
  expect(formatDate(new Date("2024-01-01"))).toBe("Jan 1, 2024")
})
```

Title: Testing & Quality

- **Linters**: Run ESLint/Prettier on changed files only. Do not reformat unrelated code.
- **Unit**: `vitest` for logic and utilities. Mock IO boundaries.
- **E2E**: `playwright` smoke for critical flows. Keep under 5 min runtime.
- **Types**: No `any`. Prefer precise generics. Enforce strict mode.
- **CI**: Cache deps; run lints, unit, then e2e (smoke) per PR.
- **Perf tests**: Track TTFB and hydration for key pages periodically.

Per-task requirement

- Every task must include adequate tests: unit for logic, and e2e or component tests for user-facing flows.
- New code without tests is not eligible for merge unless explicitly justified.

Vitest Example

```ts
test("formats date", () => {
  expect(formatDate(new Date("2024-01-01"))).toBe("Jan 1, 2024")
})
```

